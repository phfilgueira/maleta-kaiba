/* Base container for card images to enable overlays */
.card-image-wrapper {
    position: relative;
    display: block;
    overflow: hidden;
    line-height: 0; /* Remove any ghost space under the image */
    /* Creates a new stacking context, ensuring mix-blend-mode works reliably */
    isolation: isolate;
}

.card-image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensure image covers the area */
    display: block; /* Remove bottom space and positioning conflicts */
}

/* Base for all foil/holo overlays */
.card-image-wrapper::before,
.card-image-wrapper::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none; /* Make sure it doesn't block clicks */
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1; /* Place overlays on top of the image (at z-index 0) */
}

/* === ANIMATIONS === */
@keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}
@keyframes sparkle {
    0%, 100% { opacity: 0.6; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
}


/* === CLIP PATHS for targeting card areas === */
:root {
    --clip-path-full: polygon(0 0, 100% 0, 100% 100%, 0 100%);
    --clip-path-artwork: polygon(8% 11%, 92% 11%, 92% 58%, 8% 58%);
    --clip-path-name: polygon(8% 4.5%, 92% 4.5%, 92% 10%, 8% 10%);
}

/* === RARITY-SPECIFIC STYLES === */

/* --- RARE --- */
.card-image-wrapper.rarity-rare::after {
    opacity: 1;
    background: linear-gradient(110deg, #c0c0c0, #ffffff, #c0c0c0);
    mix-blend-mode: color-dodge;
    clip-path: var(--clip-path-name);
}

/* --- SUPER RARE --- */
.card-image-wrapper.rarity-super-rare::after {
    opacity: 1;
    mix-blend-mode: screen;
    clip-path: var(--clip-path-artwork);
    background: linear-gradient(110deg, rgba(255,0,0,0.3) 10%, rgba(255,255,0,0.3) 20%, rgba(0,255,0,0.3) 30%, rgba(0,255,255,0.3) 40%, rgba(0,0,255,0.3) 50%, rgba(255,0,255,0.3) 60%, rgba(255,0,0,0.3) 70%);
    background-size: 200% 100%;
    animation: shimmer 8s linear infinite;
}

/* --- ULTRA RARE --- */
.card-image-wrapper.rarity-ultra-rare::before { /* Name Foil */
    opacity: 1;
    background: linear-gradient(110deg, #b8860b, #fffacd, #b8860b);
    mix-blend-mode: color-dodge;
    clip-path: var(--clip-path-name);
}
.card-image-wrapper.rarity-ultra-rare::after { /* Holo Artwork */
    opacity: 1;
    mix-blend-mode: screen;
    clip-path: var(--clip-path-artwork);
    background: linear-gradient(110deg, rgba(255,0,0,0.3) 10%, rgba(255,255,0,0.3) 20%, rgba(0,255,0,0.3) 30%, rgba(0,255,255,0.3) 40%, rgba(0,0,255,0.3) 50%, rgba(255,0,255,0.3) 60%, rgba(255,0,0,0.3) 70%);
    background-size: 200% 100%;
    animation: shimmer 8s linear infinite;
}

/* --- SECRET RARE --- */
.card-image-wrapper.rarity-secret-rare::after {
    opacity: 1;
    background-size: 200% 200%;
    background-image: repeating-linear-gradient(
        45deg,
        rgba(255, 0, 255, 0.3),
        rgba(0, 255, 255, 0.3) 2px,
        transparent 2px,
        transparent 4px
    );
    mix-blend-mode: screen;
    animation: shimmer 4s linear infinite;
    clip-path: var(--clip-path-full); /* Secret Rare covers the whole card */
}

/* --- PRISMATIC SECRET RARE --- */
.card-image-wrapper.rarity-prismatic-secret-rare::after {
    opacity: 1;
    mix-blend-mode: screen;
    clip-path: var(--clip-path-full);
    background: 
        repeating-linear-gradient(45deg, hsla(300, 100%, 50%, 0.2), hsla(180, 100%, 50%, 0.2) 2px, transparent 2px, transparent 6px),
        repeating-linear-gradient(135deg, hsla(60, 100%, 50%, 0.2), hsla(240, 100%, 50%, 0.2) 2px, transparent 2px, transparent 6px);
    background-size: 200% 200%;
    animation: shimmer 3s linear infinite reverse;
}

/* --- GHOST RARE --- */
/* Desaturate and brighten the image itself */
.card-image-wrapper.rarity-ghost-rare .rarity-ghost-rare-img {
    filter: saturate(0.1) contrast(1.4) brightness(1.3);
}
/* Add the holographic overlay */
.card-image-wrapper.rarity-ghost-rare::after {
    opacity: 0.7;
    mix-blend-mode: color-dodge;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 0, 0.3) 25%, rgba(0, 255, 255, 0.3) 50%, rgba(255, 0, 255, 0.3) 75%, rgba(255, 255, 255, 0.6) 100%);
    background-size: 300% 300%;
    animation: shimmer 6s ease-in-out infinite;
    clip-path: var(--clip-path-artwork);
}

/* --- QUARTER CENTURY SECRET RARE --- */
.card-image-wrapper.rarity-quarter-century-secret-rare::before { /* Sparkle Overlay */
    opacity: 1;
    background-image:
      radial-gradient(circle at 15% 25%, rgba(255,255,224,0.7) 0%, transparent 1%),
      radial-gradient(circle at 80% 10%, rgba(200,200,255,0.7) 0%, transparent 1%),
      radial-gradient(circle at 50% 85%, rgba(255,220,255,0.7) 0%, transparent 1%),
      radial-gradient(circle at 90% 60%, rgba(220,255,220,0.7) 0%, transparent 1%),
      radial-gradient(circle at 30% 90%, rgba(255,255,224,0.7) 0%, transparent 1%);
    background-position: 0 0, 10px 20px, 5px 35px, 25px 15px, 30px 5px;
    background-size: 40px 40px;
    mix-blend-mode: color-dodge;
    animation: sparkle 2s infinite;
    clip-path: var(--clip-path-full);
}
.card-image-wrapper.rarity-quarter-century-secret-rare::after { /* Gold foil name */
    opacity: 1;
    background: linear-gradient(110deg, #DAA520, #FFFACD, #DAA520, #B8860B);
    mix-blend-mode: color-dodge;
    clip-path: var(--clip-path-name);
}